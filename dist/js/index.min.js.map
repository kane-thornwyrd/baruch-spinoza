{"version":3,"sources":["index.js"],"names":["ULTRASTART","Date","now","libLoad","libs","main","libKey","lib","el","tryMainLoad","rootScript","document","getElementsByTagName","loaded","mainDeps","hasDependencies","dependOn","length","resolvingCallback","console","log","name","loadStart","src","push","reloadLibs","load","parentNode","insertBefore","allDependenciesMet","deps","i","okay","indexOf","hasOwnProperty","createElement","type","async","defer","onload","interval","ID","call","window","clearInterval","cb","retry","jquery","underscore","backbone","marionette","BaruchSpinozaBooks","Marionette","Backbone","baruchSpinoza","Models","Collections","Views","domReady","runCallbacks","callbacks","doc","callReady","readyCalls","isPageLoaded","pageLoaded","scrollIntervalId","callback","isTop","testDiv","isBrowser","addEventListener","attachEvent","frameElement","e","doScroll","external","setInterval","readyState","version","req","onLoad","config","isBuild","APIs","request","url","dataRadio","Wreqr","radio","channel","_generateAJAXRequest","options","$","ajax","_","extend","accepts","cache","dataType","ifModified","complete","jqXHR","status","vent","trigger","responseJSON","_setHandler","conf","isArray","_j","_rlen","response","reqres","setHandler","each","Application","regions","header","mainContainer","defaults","initialize","this","bind","listen","on","history","start","pushState","Book","Model","isbn","title","author","price","cover","Collection","model","BookCollection","View","tagName","render","self","collection","arguments","renderBook","book","BookCard","ItemView","template","globalCh","ping","common","super","constructor","apply","container"],"mappings":"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","file":"index.min.js","sourcesContent":["var ULTRASTART = Date.now();\n\nvar libLoad = function libLoad(libs) {\n  var rootScript = document.getElementsByTagName(\"script\")[0];\n  var loaded = [], mainDeps = [], mainLoad, main;\n  var hasDependencies = function hasDependencies(lib) {\n    return !(typeof lib.dependOn === \"undefined\" || lib.dependOn.length <= 0);\n  };\n  var resolvingCallback = function resolvingCallback(lib) {\n    return function libLoaded() {\n      console.log(lib.name, \"took\", Date.now() - lib.loadStart + \"ms via\", lib.src);\n      lib.loaded = true;\n      loaded.push(lib.name);\n      reloadLibs(libs);\n      tryMainLoad(main);\n    };\n  };\n  var load = function load(lib) {\n    if (typeof lib.loaded === \"undefined\" || !lib.loaded) {\n      lib.loadStart = Date.now();\n      rootScript.parentNode.insertBefore(lib.el, rootScript);\n    }\n    return lib;\n  };\n  var allDependenciesMet = function allDependenciesMet(deps) {\n    var okay = true;\n    for (var i = deps.length - 1; i >= 0; i--) {\n      okay &= loaded.indexOf(deps[i]) === -1 !== true;\n    }\n    return okay;\n  };\n  var reloadLibs = function reloadLibs(libs) {\n    for (var libKey in libs) {\n      if (libs.hasOwnProperty(libKey) && hasDependencies(libs[libKey]) && allDependenciesMet(libs[libKey].dependOn)) {\n        load(libs[libKey]);\n      }\n    }\n  };\n  for (var libKey in libs) {\n    if (libs.hasOwnProperty(libKey)) {\n      mainDeps.push(libKey);\n      var lib = libs[libKey];\n      var el = document.createElement(\"script\");\n      el.src = libs[libKey].src;\n      el.type = \"text/javascript\";\n      el.async = \"true\";\n      el.defer = \"true\";\n      el.onload = resolvingCallback(lib);\n      lib.el = el;\n      lib.name = libKey;\n      console.log(\"Dependencies\", libKey, mainDeps);\n      if (!hasDependencies(lib)) {\n        load(lib);\n      } else {\n        if (allDependenciesMet(lib.dependOn)) {\n          load(lib);\n        }\n      }\n    }\n  }\n  var tryMainLoad = function tryMainLoad(main, interval) {\n    if (typeof interval === \"undefined\") {\n      interval = {\n        \"ID\": 0\n      };\n    }\n    if (allDependenciesMet(mainDeps)) {\n      main.call(window);\n    }\n    return clearInterval(interval.ID);\n  };\n  return function libsLoaded(cb) {\n    var retry = {\n      \"ID\": 0\n    };\n    main = cb;\n    retry.ID = tryMainLoad(cb, retry);\n  };\n};\n\nlibLoad({\n  \"jquery\": {\n    \"src\": \"https://cdn.jsdelivr.net/jquery/2.1.4/jquery.min.js\"\n  },\n  \"underscore\": {\n    \"src\": \"https://cdn.jsdelivr.net/underscorejs/1.8.3/underscore-min.js\"\n  },\n  \"backbone\": {\n    \"src\": \"https://cdn.jsdelivr.net/backbonejs/1.2.1/backbone-min.js\",\n    \"dependOn\": [ \"jquery\", \"underscore\" ]\n  },\n  \"marionette\": {\n    \"src\": \"https://cdn.jsdelivr.net/backbone.marionette/2.4.2/backbone.marionette.min.js\",\n    \"dependOn\": [ \"backbone\" ]\n  }\n})(function libLoadedCallback() {\n  var Marionette = Backbone.Marionette;\n  var baruchSpinoza = {\n    \"Models\": {},\n    \"Collections\": {},\n    \"Views\": {}\n  };\n  var domReady = function() {\n    var isTop, testDiv, scrollIntervalId, isBrowser = typeof window !== \"undefined\" && window.document, isPageLoaded = !isBrowser, doc = isBrowser ? document : null, readyCalls = [];\n    function runCallbacks(callbacks) {\n      var i;\n      for (i = 0; i < callbacks.length; i += 1) {\n        callbacks[i](doc);\n      }\n    }\n    function callReady() {\n      var callbacks = readyCalls;\n      if (isPageLoaded) {\n        if (callbacks.length) {\n          readyCalls = [];\n          runCallbacks(callbacks);\n        }\n      }\n    }\n    function pageLoaded() {\n      if (!isPageLoaded) {\n        isPageLoaded = true;\n        if (scrollIntervalId) {\n          clearInterval(scrollIntervalId);\n        }\n        callReady();\n      }\n    }\n    if (isBrowser) {\n      if (document.addEventListener) {\n        document.addEventListener(\"DOMContentLoaded\", pageLoaded, false);\n        window.addEventListener(\"load\", pageLoaded, false);\n      } else {\n        if (window.attachEvent) {\n          window.attachEvent(\"onload\", pageLoaded);\n          testDiv = document.createElement(\"div\");\n          try {\n            isTop = window.frameElement === null;\n          } catch (e) {}\n          if (testDiv.doScroll && isTop && window.external) {\n            scrollIntervalId = setInterval(function() {\n              try {\n                testDiv.doScroll();\n                pageLoaded();\n              } catch (e) {}\n            }, 30);\n          }\n        }\n      }\n      if (document.readyState === \"complete\") {\n        pageLoaded();\n      }\n    }\n    /**\r\n   * Registers a callback for DOM ready. If DOM is already ready, the\r\n   * callback is called immediately.\r\n   * @param {Function} callback\r\n   */\n    function domReady(callback) {\n      if (isPageLoaded) {\n        callback(doc);\n      } else {\n        readyCalls.push(callback);\n      }\n      return domReady;\n    }\n    domReady.version = \"2.0.1\";\n    domReady.load = function(name, req, onLoad, config) {\n      if (config.isBuild) {\n        onLoad(null);\n      } else {\n        domReady(onLoad);\n      }\n    };\n    return domReady;\n  }();\n  var APIs = [ {\n    \"request\": \"get:books\",\n    \"url\": \"http://henri-potier.xebia.fr/books\"\n  } ];\n  var dataRadio = Backbone.Wreqr.radio.channel(\"data\");\n  var _generateAJAXRequest = function _generateAJAXRequest(request, url, options) {\n    return function() {\n      return $.ajax(url, _.extend({\n        \"accepts\": [ \"text/json\" ],\n        \"cache\": true,\n        \"dataType\": \"json\",\n        \"ifModified\": true,\n        \"complete\": function(jqXHR, status, errorThrown) {\n          Backbone.Wreqr.radio.channel(\"data\").vent.trigger(status, request, jqXHR.responseJSON, jqXHR);\n        }\n      }, options));\n    };\n  }, _setHandler = function _setHandler(conf) {\n    if (_.isArray(conf.request)) {\n      for (var _j = 0, _rlen = conf.request.length; _j < _rlen; _j++) {\n        if (typeof conf.response === \"undefined\") {\n          if (typeof conf.url !== \"undefined\") {\n            dataRadio.reqres.setHandler(conf.request[_j], _generateAJAXRequest(conf.request[_j], conf.url));\n          }\n        } else {\n          dataRadio.reqres.setHandler(conf.request[_j], conf.response);\n        }\n      }\n    } else {\n      dataRadio.reqres.setHandler(conf.request, _generateAJAXRequest(conf.request, conf.url));\n    }\n  };\n  _.each(APIs, _setHandler);\n  var BaruchSpinozaBooks = Marionette.Application.extend({\n    \"regions\": {\n      \"header\": \".site-header\",\n      \"mainContainer\": \".main-container\"\n    },\n    \"defaults\": {},\n    \"initialize\": function applicationInitialize(options) {\n      this.options = _.extend({}, this.defaults, options);\n      domReady(_.bind(function() {\n        this.vent.trigger(\"domReady\", this);\n      }, this));\n      console.log(\"App initialized\");\n      return this.listen();\n    },\n    \"listen\": function appListen() {\n      this.on(\"start\", function() {\n        console.log(\"START\");\n        this.vent.on(\"domReady\", function() {\n          try {\n            Backbone.history.start({\n              \"pushState\": true\n            });\n            console.log(\"BACKBONE HISTORY RUNNING…\");\n          } catch (e) {\n            console.log(e);\n          }\n        });\n      });\n      return this;\n    }\n  });\n  baruchSpinoza.Models.Book = Backbone.Model.extend({\n    \"defaults\": {\n      \"isbn\": \"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\",\n      \"title\": \"default title\",\n      \"author\": \"Jeanne Catherine Rangeant\",\n      \"price\": 0,\n      \"cover\": \"http://placekitten.com/g/200/300\"\n    }\n  });\n  baruchSpinoza.Collections.Book = Backbone.Collection.extend({\n    \"model\": baruchSpinoza.Models.Book\n  });\n  baruchSpinoza.Views.BookCollection = Backbone.View.extend({\n    \"tagName\": \"ul\",\n    \"render\": function bookCollectionViewRender() {\n      var self = this;\n      domReady(function bookCollectionViewRenderDomReady() {\n        self.collection.each(function() {\n          console.log(\"COloction: \", arguments);\n        });\n      });\n    },\n    \"renderBook\": function bookCollectionViewRenderBook(book) {\n      var bookView = new baruchSpinoza.Views.Book({\n        \"model\": book\n      });\n    }\n  });\n  baruchSpinoza.Views.BookCard = Marionette.ItemView.extend({\n    \"template\": \"#bookCard\",\n    \"initialize\": function bookViewInitialize() {\n      var globalCh = Backbone.Wreqr.radio.channel(\"global\");\n      console.log(\"globalCh\", globalCh);\n      globalCh.vent.on(\"domReady\", this.ping);\n    },\n    \"ping\": function() {\n      console.log(\"PING !\");\n    }\n  });\n  baruchSpinoza.Views.common = Marionette.ItemView.extend(Backbone.Model.extend({\n    \"super\": baruchSpinoza.Views.common,\n    \"constructor\": function commonItemViewConstructor(options) {\n      Marionette.ItemView.apply(this, arguments);\n    }\n  }));\n  new BaruchSpinozaBooks({\n    \"container\": \"body\"\n  }).start();\n  Backbone.Wreqr.radio.channel(\"data\").vent.on(\"success\", function(req, res) {\n    if (req === \"get:books\") {\n      console.log(\"GET BOOKS !\", arguments);\n    }\n  });\n  Backbone.Wreqr.radio.channel(\"data\").reqres.request(\"get:books\");\n});"],"sourceRoot":"/source/"}