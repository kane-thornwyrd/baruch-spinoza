var ULTRASTART=Date.now(),libLoad=function(t){"use strict";var e,n,a,r,o,i=document.getElementsByTagName("script")[0],s=[],u=[],c=function(t){return!(void 0===t.dependOn||t.dependOn.length<=0)},l=function(n){return function(){console.log(n.name,"took",Date.now()-n.loadStart+"ms via",n.src),n.loaded=!0,s.push(n.name),h(t),o(e)}},d=function(t){return void 0!==t.loaded&&t.loaded||(t.loadStart=Date.now(),i.parentNode.insertBefore(t.el,i)),t},p=function(t){var e,n=!0;for(e=t.length-1;e>=0;e--)n&=-1===s.indexOf(t[e])!=!0;return n},h=function(t){for(var e in t)t.hasOwnProperty(e)&&c(t[e])&&p(t[e].dependOn)&&d(t[e])};for(n in t)t.hasOwnProperty(n)&&(u.push(n),a=t[n],r=document.createElement("script"),r.src=t[n].src,r.type="text/javascript",r.async="true",r.defer="true",r.onload=l(a),a.el=r,a.name=n,console.log("Dependencies",n,u),c(a)?p(a.dependOn)&&d(a):d(a));return o=function(t,e){return void 0===e&&(e={ID:0}),p(u)&&t.call(window),clearInterval(e.ID)},function(t){var n={ID:0};e=t,n.ID=o(t,n)}};libLoad({jquery:{src:"https://cdn.jsdelivr.net/jquery/2.1.4/jquery.min.js"},underscore:{src:"https://cdn.jsdelivr.net/underscorejs/1.8.3/underscore-min.js"}})(function(){"use strict";$(function(){var t,e,n,a,r,o,i;$("html").removeClass("no-js").addClass("js"),_.templateSettings={interpolate:/\{\{= (.+?)\}\}/g,escape:/\{\{!(.+?)\}\}/g,evaluate:/\{\{(.+?)\s\}\}/g},function(t,e){var n={pulses:1,interval:0,returnDelay:0,duration:500};t.fn.pulse=function(a,r,o){var i="destroy"===a;return"function"==typeof r&&(o=r,r={}),r=t.extend({},n,r),r.interval>=0||(r.interval=0),r.returnDelay>=0||(r.returnDelay=0),r.duration>=0||(r.duration=500),r.pulses>=-1||(r.pulses=1),"function"!=typeof o&&(o=function(){}),this.each(function(){function n(){return void 0===d.data("pulse")||d.data("pulse").stop?void 0:r.pulses>-1&&++u>r.pulses?o.apply(d):void d.animate(a,l)}var s,u,c,l,d=t(this),p={},h=d.data("pulse")||{};h.stop=i,d.data("pulse",h);for(s in a)a.hasOwnProperty(s)&&(p[s]=d.css(s));u=0,c=t.extend({},r),c.duration=r.duration/2,c.complete=function(){e.setTimeout(n,r.interval)},l=t.extend({},r),l.duration=r.duration/2,l.complete=function(){e.setTimeout(function(){d.animate(p,c)},r.returnDelay)},n()})}}(jQuery,window,document),$.pluginMaker=$.pluginMaker||function(t){return $.fn[t.prototype.meta.name]=function(e){var n=$.makeArray(arguments),a=n.slice(1);return this.each(function(){var r,o,i=$.data(this,"_"+t.prototype.meta.name);i?"string"==typeof e?i[e].apply(i,a):i.update&&i.update.apply(i,n):(r=t.prototype.defaultConf,r&&(e=$.extend(!0,{},r,e)),o=$(this).addClass(t.prototype.meta.name),i=new t(o,e),o.data("_"+t.prototype.meta.name,i),i.teardown?o.bind("destroyed",$.proxy(i.teardown,i)):o.one("destroyed",function(){o.removeData("_"+t.prototype.meta.name,i).removeClass(t.prototype.meta.name)}))})},$.fn[t.prototype.meta.name]},t=function s(t,e){return this.attr=_.extend({},this.defaults,e),this.attr.commercialBackendRequestTemplate=_.template(_.template(this.attr.commercialBackendRequestTemplate)({algorithm:s.prototype.isbnConcatAlgorithms[this.attr.isbnConcatAlgorithms]()})),this.attr.$el=t,this.counter=$('<span class="item-count hide"></span>'),this.attr.$el.append(this.counter),this.listen()},_.extend(t.prototype,{meta:{name:"ShoppingCart"},defaults:{cart:[],indexKey:"isbn",isbnConcatAlgorithms:"single",commercialBackendRequestTemplate:"http://henri-potier.xebia.fr/books/{{= algorithm }}/commercialOffers",cartView:void 0},availableISBNConcatAlgorithms:["single","multiple"],listen:function(){this.cartViewState=!this.attr.cartView.hasClass("hide");var t=_.partial(this.cartButtonCallback,this);return this.attr.cartView.on("click",".close",t),this.attr.$el.on("click",t),this},cartButtonCallback:function(t,e){e.preventDefault(),e.stopPropagation(),t.cartViewState?t.hideCart():t.showCart()},showCart:function(){this.attr.cartView.slideUp().removeClass("hide"),this.cartViewState=!0},hideCart:function(){this.attr.cartView.slideDown().addClass("hide"),this.cartViewState=!1},isbnConcatAlgorithms:{single:function(){return"{{= _.pluck(books, 'isbn').join(',') }}"},multiple:function(){var t="var algo = function concatAlgo(books){var book, i, isbns=[], len, y;_.each(books, function(book){_(book.quantity).times(function(n){isbns.push(book.isbn);});});return isbns.join(',');};";return"{{"+t+"}}{{= algo(books) }}"}},push:function(t){var e,n,a;if(_.isArray(t))for(e in t)t.hasOwnProperty(e)&&this.push(e);else n=this.itemAlreadyInCart(t),a=this,n||(n=_.extend({quantity:0,addOne:function(){n.quantity++,a.increaseCounter.call(a)}},t),this.attr.cart.push(n)),n.addOne()},getItemsAmount:function(){return _.reduce(_.pluck(this.attr.cart,"quantity"),function(t,e){return t+e})},increaseCounter:function(t){t=t||1;var e=this.counter.data("amount")||0;return this.counter.data("amount",e+t),this.refreshCounter()},decreaseCounter:function(t){t=t||1;var e=this.counter.data("amount")||0;return this.counter.data("amount",e-t),this.refreshCounter()},resetCounter:function(){return this.counter.data("amount",0),this.refreshCounter()},refreshCounter:function(){var t=this.counter.data("amount")||this.getItemsAmount();return this.counter.html(t),t?this.counter.removeClass("hide"):this.counter.addClass("hide"),this},itemAlreadyInCart:function(t){var e={};return e[this.attr.indexKey]=t[this.attr.indexKey],this.get(e)},get:function(t){return _.findWhere(this.attr.cart,t)||!1},askPrice:function(){console.log(this.attr.commercialBackendRequestTemplate({books:this.attr.cart}))}}),$.pluginMaker(t),e=$.ajax("http://henri-potier.xebia.fr/books"),n=$("#shoppingCartAccess").ShoppingCart({cartView:$("#cart")}).data("_ShoppingCart"),a={bookFullTpl:_.template(window.bookFull.innerHTML),booksTpl:_.template(window.books.innerHTML)},r=$(".main-container"),o=$(".loader"),i=function(t){var a,r;t.preventDefault(),t.stopPropagation(),a=$(this),r=_.findWhere(e,{isbn:a.data("isbn")}),n.push(r),setTimeout(function(){a.blur()},10)},e.done(function(t){e=t,r.append(a.booksTpl({books:e,bookTpl:a.bookFullTpl})).find("button.add").on("click",i)}),e.fail(function(){r.append(booksTpl())}),e.always(function(){o.hide()})})});
//# sourceMappingURL=index.min.js.map