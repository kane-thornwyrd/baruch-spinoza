{"version":3,"sources":["index.js"],"names":["ULTRASTART","Date","now","libLoad","libs","main","libKey","lib","el","tryMainLoad","rootScript","document","getElementsByTagName","loaded","mainDeps","hasDependencies","dependOn","length","resolvingCallback","console","log","name","loadStart","src","push","reloadLibs","load","parentNode","insertBefore","allDependenciesMet","deps","i","okay","indexOf","hasOwnProperty","createElement","type","async","defer","onload","interval","ID","call","window","clearInterval","cb","retry","jquery","underscore","$","ShoppingCart","books","shoppingCart","TPLs","$mainContainer","$loader","addingCallback","removeClass","addClass","_","templateSettings","interpolate","escape","evaluate","t","e","n","pulses","returnDelay","duration","fn","pulse","u","a","r","extend","this","each","s","data","stop","p","apply","animate","f","o","c","l","d","css","complete","setTimeout","jQuery","pluginMaker","Plugin","prototype","meta","options","args","makeArray","arguments","after","slice","def","$this","instance","update","defaultConf","teardown","bind","proxy","one","removeData","$el","attr","defaults","commercialBackendRequestTemplate","template","algorithm","isbnConcatAlgorithms","counter","append","listen","cart","indexKey","cartView","undefined","availableISBNConcatAlgorithms","cartViewState","hasClass","cartToggleCB","partial","cartButtonCallback","on","ctx","preventDefault","stopPropagation","hideCart","showCart","slideUp","slideDown","single","multiple","helper","input","book","alreadyInCart","_self","isArray","itemAlreadyInCart","quantity","addOne","increaseCounter","getItemsAmount","reduce","pluck","m","v","amount","prev","refreshCounter","decreaseCounter","resetCounter","html","item","select","get","findWhere","askPrice","ajax","bookFullTpl","bookFull","innerHTML","booksTpl","isbn","blur","done","bookTpl","find","fail","always","hide"],"mappings":"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","file":"index.min.js","sourcesContent":["var ULTRASTART = Date.now();\n\nvar libLoad = function libLoad(libs) {\n  \"use strict\";\n  var rootScript = document.getElementsByTagName(\"script\")[0];\n  var loaded = [], mainDeps = [], mainLoad, main;\n  var hasDependencies = function hasDependencies(lib) {\n    return !(typeof lib.dependOn === \"undefined\" || lib.dependOn.length <= 0);\n  };\n  var resolvingCallback = function resolvingCallback(lib) {\n    return function libLoaded() {\n      console.log(lib.name, \"took\", Date.now() - lib.loadStart + \"ms via\", lib.src);\n      lib.loaded = true;\n      loaded.push(lib.name);\n      reloadLibs(libs);\n      tryMainLoad(main);\n    };\n  };\n  var load = function load(lib) {\n    if (typeof lib.loaded === \"undefined\" || !lib.loaded) {\n      lib.loadStart = Date.now();\n      rootScript.parentNode.insertBefore(lib.el, rootScript);\n    }\n    return lib;\n  };\n  var allDependenciesMet = function allDependenciesMet(deps) {\n    var okay = true;\n    for (var i = deps.length - 1; i >= 0; i--) {\n      okay &= loaded.indexOf(deps[i]) === -1 !== true;\n    }\n    return okay;\n  };\n  var reloadLibs = function reloadLibs(libs) {\n    for (var libKey in libs) {\n      if (libs.hasOwnProperty(libKey) && hasDependencies(libs[libKey]) && allDependenciesMet(libs[libKey].dependOn)) {\n        load(libs[libKey]);\n      }\n    }\n  };\n  for (var libKey in libs) {\n    if (libs.hasOwnProperty(libKey)) {\n      mainDeps.push(libKey);\n      var lib = libs[libKey];\n      var el = document.createElement(\"script\");\n      el.src = libs[libKey].src;\n      el.type = \"text/javascript\";\n      el.async = \"true\";\n      el.defer = \"true\";\n      el.onload = resolvingCallback(lib);\n      lib.el = el;\n      lib.name = libKey;\n      console.log(\"Dependencies\", libKey, mainDeps);\n      if (!hasDependencies(lib)) {\n        load(lib);\n      } else {\n        if (allDependenciesMet(lib.dependOn)) {\n          load(lib);\n        }\n      }\n    }\n  }\n  var tryMainLoad = function tryMainLoad(main, interval) {\n    if (typeof interval === \"undefined\") {\n      interval = {\n        \"ID\": 0\n      };\n    }\n    if (allDependenciesMet(mainDeps)) {\n      main.call(window);\n    }\n    return clearInterval(interval.ID);\n  };\n  return function libsLoaded(cb) {\n    var retry = {\n      \"ID\": 0\n    };\n    main = cb;\n    retry.ID = tryMainLoad(cb, retry);\n  };\n};\n\nlibLoad({\n  \"jquery\": {\n    \"src\": \"https://cdn.jsdelivr.net/jquery/2.1.4/jquery.min.js\"\n  },\n  \"underscore\": {\n    \"src\": \"https://cdn.jsdelivr.net/underscorejs/1.8.3/underscore-min.js\"\n  }\n})(function libLoadedCallback() {\n  \"use strict\";\n  $(function() {\n    $(\"html\").removeClass(\"no-js\").addClass(\"js\");\n    _.templateSettings = {\n      \"interpolate\": /\\{\\{= (.+?)\\}\\}/g,\n      \"escape\": /\\{\\{!(.+?)\\}\\}/g,\n      \"evaluate\": /\\{\\{(.+?)\\s\\}\\}/g\n    };\n    (function(t, e) {\n      \"use strict\";\n      var n = {\n        \"pulses\": 1,\n        \"interval\": 0,\n        \"returnDelay\": 0,\n        \"duration\": 500\n      };\n      t.fn.pulse = function(u, a, r) {\n        var i = \"destroy\" === u;\n        return \"function\" == typeof a && (r = a, a = {}), a = t.extend({}, n, a), a.interval >= 0 || (a.interval = 0), \n        a.returnDelay >= 0 || (a.returnDelay = 0), a.duration >= 0 || (a.duration = 500), \n        a.pulses >= -1 || (a.pulses = 1), \"function\" != typeof r && (r = function() {}), \n        this.each(function() {\n          function n() {\n            return void 0 === s.data(\"pulse\") || s.data(\"pulse\").stop ? void 0 : a.pulses > -1 && ++p > a.pulses ? r.apply(s) : (s.animate(u, f), \n            void 0);\n          }\n          var o, s = t(this), l = {}, d = s.data(\"pulse\") || {};\n          d.stop = i, s.data(\"pulse\", d);\n          for (o in u) {\n            u.hasOwnProperty(o) && (l[o] = s.css(o));\n          }\n          var p = 0, c = t.extend({}, a);\n          c.duration = a.duration / 2, c.complete = function() {\n            e.setTimeout(n, a.interval);\n          };\n          var f = t.extend({}, a);\n          f.duration = a.duration / 2, f.complete = function() {\n            e.setTimeout(function() {\n              s.animate(l, c);\n            }, a.returnDelay);\n          }, n();\n        });\n      };\n    })(jQuery, window, document);\n    /*\n * pluginMaker\n * Easy jQuery plugin registering.\n *\n * @module pluginMaker\n *\n * Copyright (c) 2014 Jean-cédric Thérond - Cellfish Media France\n * Proprietary Software.\n */\n    $.pluginMaker = $.pluginMaker || function(Plugin) {\n      $.fn[Plugin.prototype.meta.name] = function(options) {\n        var args = $.makeArray(arguments), after = args.slice(1);\n        return this.each(function() {\n          var instance = $.data(this, \"_\" + Plugin.prototype.meta.name);\n          if (instance) {\n            if (typeof options === \"string\") {\n              instance[options].apply(instance, after);\n            } else {\n              if (instance.update) {\n                instance.update.apply(instance, args);\n              }\n            }\n          } else {\n            var def = Plugin.prototype.defaultConf;\n            if (def) {\n              options = $.extend(true, {}, def, options);\n            }\n            var $this = $(this).addClass(Plugin.prototype.meta.name);\n            instance = new Plugin($this, options);\n            $this.data(\"_\" + Plugin.prototype.meta.name, instance);\n            if (instance.teardown) {\n              $this.bind(\"destroyed\", $.proxy(instance.teardown, instance));\n            } else {\n              $this.one(\"destroyed\", function() {\n                $this.removeData(\"_\" + Plugin.prototype.meta.name, instance).removeClass(Plugin.prototype.meta.name);\n              });\n            }\n          }\n        });\n      };\n      return $.fn[Plugin.prototype.meta.name];\n    };\n    var ShoppingCart = function ShoppingCart($el, options) {\n      \"use strict\";\n      this.attr = _.extend({}, this.defaults, options);\n      this.attr.commercialBackendRequestTemplate = _.template(_.template(this.attr.commercialBackendRequestTemplate)({\n        \"algorithm\": ShoppingCart.prototype.isbnConcatAlgorithms[this.attr.isbnConcatAlgorithms]()\n      }));\n      this.attr.$el = $el;\n      this.counter = $('<span class=\"item-count hide\"></span>');\n      this.attr.$el.append(this.counter);\n      return this.listen();\n    };\n    _.extend(ShoppingCart.prototype, {\n      \"meta\": {\n        \"name\": \"ShoppingCart\"\n      },\n      \"defaults\": {\n        \"cart\": [],\n        \"indexKey\": \"isbn\",\n        \"isbnConcatAlgorithms\": \"single\",\n        \"commercialBackendRequestTemplate\": \"http://henri-potier.xebia.fr/books/{{= algorithm }}/commercialOffers\",\n        \"cartView\": undefined\n      },\n      \"availableISBNConcatAlgorithms\": [ \"single\", \"multiple\" ],\n      \"listen\": function shoppingCartListen() {\n        \"use strict\";\n        this.cartViewState = !this.attr.cartView.hasClass(\"hide\");\n        var cartToggleCB = _.partial(this.cartButtonCallback, this);\n        this.attr.cartView.on(\"click\", \".close\", cartToggleCB);\n        this.attr.$el.on(\"click\", cartToggleCB);\n        return this;\n      },\n      \"cartButtonCallback\": function shoppingCartCartButtonCallback(ctx, e) {\n        \"use strict\";\n        e.preventDefault();\n        e.stopPropagation();\n        if (ctx.cartViewState) {\n          ctx.hideCart();\n        } else {\n          ctx.showCart();\n        }\n      },\n      \"showCart\": function shoppingCartShowCart() {\n        \"use strict\";\n        this.attr.cartView.slideUp().removeClass(\"hide\");\n        this.cartViewState = true;\n      },\n      \"hideCart\": function shoppingCartHideCart() {\n        \"use strict\";\n        this.attr.cartView.slideDown().addClass(\"hide\");\n        this.cartViewState = false;\n      },\n      \"isbnConcatAlgorithms\": {\n        \"single\": function singleIsbnConcatAlgorithm() {\n          \"use strict\";\n          return \"{{= _.pluck(books, 'isbn').join(',') }}\";\n        },\n        \"multiple\": function singleIsbnConcatAlgorithm() {\n          \"use strict\";\n          var helper = \"var algo = function concatAlgo(books){\" + \"var book, i, isbns=[], len, y;\" + \"_.each(books, function(book){_(book.quantity).times(function(n){isbns.push(book.isbn);});});\" + \"return isbns.join(',');\" + \"};\";\n          return \"{{\" + helper + \"}}{{= algo(books) }}\";\n        }\n      },\n      \"push\": function shoppingCartPush(input) {\n        \"use strict\";\n        if (_.isArray(input)) {\n          for (var book in input) {\n            if (input.hasOwnProperty(book)) {\n              this.push(book);\n            }\n          }\n        } else {\n          var alreadyInCart = this.itemAlreadyInCart(input);\n          var _self = this;\n          if (!alreadyInCart) {\n            alreadyInCart = _.extend({\n              \"quantity\": 0,\n              \"addOne\": function itemAddOne() {\n                alreadyInCart.quantity++;\n                _self.increaseCounter.call(_self);\n              }\n            }, input);\n            this.attr.cart.push(alreadyInCart);\n          }\n          alreadyInCart.addOne();\n        }\n      },\n      \"getItemsAmount\": function shoppingCartGetItemsAmount() {\n        \"use strict\";\n        return _.reduce(_.pluck(this.attr.cart, \"quantity\"), function(m, v) {\n          return m + v;\n        });\n      },\n      \"increaseCounter\": function shoppingCartIncreaseCounter(amount) {\n        \"use strict\";\n        amount = amount || 1;\n        var prev = this.counter.data(\"amount\") || 0;\n        this.counter.data(\"amount\", prev + amount);\n        return this.refreshCounter();\n      },\n      \"decreaseCounter\": function shoppingCartDecreaseCounter(amount) {\n        \"use strict\";\n        amount = amount || 1;\n        var prev = this.counter.data(\"amount\") || 0;\n        this.counter.data(\"amount\", prev - amount);\n        return this.refreshCounter();\n      },\n      \"resetCounter\": function shoppingCartresetCounter() {\n        \"use strict\";\n        this.counter.data(\"amount\", 0);\n        return this.refreshCounter();\n      },\n      \"refreshCounter\": function shoppingCartrefreshCounter() {\n        \"use strict\";\n        var amount = this.counter.data(\"amount\") || this.getItemsAmount();\n        this.counter.html(amount);\n        if (amount) {\n          this.counter.removeClass(\"hide\");\n        } else {\n          this.counter.addClass(\"hide\");\n        }\n        return this;\n      },\n      \"itemAlreadyInCart\": function shoppingCartItemAlreadyInCart(item) {\n        \"use strict\";\n        var select = {};\n        select[this.attr.indexKey] = item[this.attr.indexKey];\n        return this.get(select);\n      },\n      \"get\": function shoppingCartGet(select) {\n        \"use strict\";\n        return _.findWhere(this.attr.cart, select) || false;\n      },\n      \"askPrice\": function shoppingCartAskPrice() {\n        \"use strict\";\n        console.log(this.attr.commercialBackendRequestTemplate({\n          \"books\": this.attr.cart\n        }));\n      }\n    });\n    $.pluginMaker(ShoppingCart);\n    var books = $.ajax(\"http://henri-potier.xebia.fr/books\"), shoppingCart = $(\"#shoppingCartAccess\").ShoppingCart({\n      \"cartView\": $(\"#cart\")\n    }).data(\"_ShoppingCart\"), TPLs = {\n      \"bookFullTpl\": _.template(window.bookFull.innerHTML),\n      \"booksTpl\": _.template(window.books.innerHTML)\n    }, $mainContainer = $(\".main-container\"), $loader = $(\".loader\");\n    var addingCallback = function addingCallback(e) {\n      \"use strict\";\n      e.preventDefault();\n      e.stopPropagation();\n      var $this = $(this);\n      var book = _.findWhere(books, {\n        \"isbn\": $this.data(\"isbn\")\n      });\n      shoppingCart.push(book);\n      setTimeout(function() {\n        $this.blur();\n      }, 10);\n    };\n    books.done(function(data, textStatus, jqXHR) {\n      \"use strict\";\n      books = data;\n      $mainContainer.append(TPLs.booksTpl({\n        \"books\": books,\n        \"bookTpl\": TPLs.bookFullTpl\n      })).find(\"button.add\").on(\"click\", addingCallback);\n    });\n    books.fail(function(jqXHR, textStatus, error) {\n      \"use strict\";\n      $mainContainer.append(booksTpl());\n    });\n    books.always(function() {\n      \"use strict\";\n      $loader.hide();\n    });\n  });\n});"],"sourceRoot":"/source/"}